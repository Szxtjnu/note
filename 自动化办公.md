## 如何使用python写一个自动化办公程序

#### 一、前提

作为一位计算机专业的学生，每当我遇到一堆数据，特别是在excel中的数据需要整理的时候总是特别的头疼，因为这些对这些数据进行的操作总是最简单的，但是数据量很大，所以就需要花费很长的时间来去一个一个的处理，这显然是不符合办公效率的一件事情。（虽然摸鱼的时候很有用

于是我便想到，这样重复的工作难道不正是计算机喜欢做的工作嘛？简单，重复，有规律。于是当我接到了一个新任务的时候，我开始设想，我是不是能将这个任务使用计算机来快速的完成呢？于是我开始了寻找合适工具的过程。

首先，我先简要的说明一下这个工作的大致内容：

1.  我们面前有250份student的数据，其中包含姓名，学号（\*这个十分重要），班级，电话，家庭住址，宿舍号等等一系列的个人信息。
2.  对应的，我们有每个人所对应的照片，这里的照片已经按照学号+姓名的方式所命名好了
3.  我们要做的工作就是从整体的excel表中，抽取出一个同学的个人信息，再找到这个同学的照片，组合成为一段图文信息，并且将其整理到word之中。

可以先试想一下，这样的工作量。如果说一个人，一台电脑的话，熟练word的人可能也需要几天的时间来完成这项工作。但是这样枯燥无聊的工作为什么不将其甩给电脑做呢？

#### 二、分析

于是我开始了分析的过程，我们可以将这个过程简化为，从excel表中抽取一行的信息，主键是学号，因为这是每个人所不同的身份识别码，就相当于是IDCard。然后找到照片中所对应的这个同学的照片，组合信息，输入到word文档当中。

这整个过程都是可以单元化的，也就是可以用一个个函数所完成的。

于是我找到了我最熟悉的C++同学，询问他是否有解决办法，能够完成上述的工作，但是他毅然决然的回复了我，NO，因为c++的个人原因，使用它的学习成本实在是太高了，需要先找到对应的SDK，但是百度告诉我，并没有那么好找。于是我去拜访了最近比较火的python同学，他很热情啊，一见面就给了我叫做什么python-docx、xlrd库的东西，还把我直接拉进了他家，说这种小事何足挂齿。于是乎我就顺利的找到了我的合作伙伴。

鉴于python语言第三方库的成熟，很轻松的就找到了对应office的第三方库，于是我开始了学习的过程，首先我得把这第三方库安装在我的电脑中啊。在cmd界面，输入

```
 pip install python_docx
 pip install xlrd
```

这两行命令并等待些许时间即可安装完成，PS你的电脑中至少得有python3.7.x。

好了现在第三方库已经安装好了，接下来就是学习里面的函数，找到我们需要的函数并且把它学会就ok了！！

这里我使用的是VScode，大家也可以使用pycharm，或者是别的IDE都可以。

#### 三、处理信息以及编写代码

由于照片的文件名是学号+姓名的方式命名的，这不利于我们后面使用python插入照片，于是我先写了一个批量修改文件名的小程序。

```python
import os
num = 1
path='C:/Users/hydro/Desktop'
for file in os.listdir(path):
    os.rename(os.path.join(path,file),os.path.join(path,str(num)+".jpg"))
    num+=1
```

这就是一个很简单的小程序，我就不过多分析了，用的时候把path的路径修改，文件的后缀修改即可。

我这里面很粗暴的直接把名字改为了从1开始的数字，方便后续操作。

好了，完事具备，只欠东风。我这里先把需要准备的文件列一下。

![](https://pic.imgdb.cn/item/6162d42a2ab3f51d91e01bb5.jpg)

1.jpg是准备的照片，这里为了保护个人隐私所以我只能用我自己的给大家演示一下了。

test.docx是需要首先新建好的，里面最好先敲两个空格，因为完全空白的文档使用python命令是打不开的。

test.xlsx是个人信息，这里的个人信息有五列，由于只有我一个人，所以只有一行。这两个数字也很关键

test.py是主程序。

好了，我们现在打开主程序，看看代码是如何编写的吧。

PS.所有的文件最好放在同一目录下，方便操作。

```python
from docx import Document
from docx.shared import Cm
import xlrd
import numpy as np

data = xlrd.open_workbook("test.xlsx")  #使用xlrd.open_workbook函数打开含有信息的excel表
sheet = data.sheet_by_index(0)  #选择第一个工作簿

docu = Document('test.docx')  #打开test.docx文档
temp = 1 #照片名称变量
idx = 0  #表格行数变量
table1 = docu.add_table(1,1)  #word中创建表格

#照片的处理
for i in range(len(table1.rows)):
    table1.rows[i].height = Cm(7.21)		#设置行高7.21
    for j in range(len(table1.columns)):
        table1.cell(i,j).width = Cm(6.14)   #设置列宽6.14

#信息的插入
for i in range(0,1):
    for j in range(0,1):
        cell = table1.cell(i,j)		#选择第0列第0行
        c_p1 = cell.paragraphs[0]	#创建一个新的自然段
        c_run1 = c_p1.add_run()
        cell_pc = c_run1.add_picture(str(temp)+'.jpg',width=Cm(2.5))	#插入照片，并设置照片大小为6.14cm
        c_p2 = cell.add_paragraph(text = ("姓名",str(sheet.cell(idx,0)),"号",str(sheet.cell(idx,1)),"联系方式",str(sheet.cell(idx,2)),"家庭住址",str(sheet.cell(idx,3)),"宿舍号",str(sheet.cell(idx,4))),style = None)	#插入信息，这里面包含了字符串和变量的引用

        #！！若信息不止一行，这里需要对idx和temp两个计数器做累加，if和自增语句即可实现

docu.save('test.docx')		#保存为test.docx文件
```

好啦，这样的一个自动化办公小程序就写完了，是不是很简单呢？其实这两个第三方库中所包含的功能远远不止这些，有需要的话可以百度搜索.

![](https://pic.imgdb.cn/item/6162d9b32ab3f51d91e91011.jpg)

这里可以看到信息前面还有一些固定的格式，我们可以使用word自带的替换功能进行编辑即可！！

#### 四、问题分析以及总结

从接到任务开始，到把成果上交也就十二个小时不到吧，说几点问题，个人的python语言能力太差了实在是，导致写程序的时候总是语法出错，很是尴尬。其次就是照片的问题，因为有些照片的格式有问题，我一开始不得不挨个排查，想着最后替换，但是实在是太多了，而且这个状况还是在处理了一半的时候发生的，导致我不得不先去睡觉。直到第二天，我才试着用格式工厂将照片先导成png格式，再导成jpg格式。

总的来说，这样处理大批量数据的时候是很方便的，充分的彰显了计算机的优越性。