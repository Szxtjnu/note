# Topsis模型

## 层次分析法的局限性

1. 评价的决策层不能太多，太多的话n会很大，判断矩阵和一致矩阵差异可能会很大
2. 如果决策层中指标的数据是已知的，一般不选择采用层次分析法

## Topsis模型指标

### 指标分类

对于模型中的指标来说，常见有四种类型

- 对于越大越好的值来说，这样的指标被称为极大型指标（即效益型指标）
	- 例如：成绩、GDP增速、企业利润

- 对于越小越好的值来说，这样的指标被称为极小型指标（即成本型指标）
	- 例如：费用、坏品率、污染程度

- 对于越接近某个值越好的值来说，这样的指标被称为中间型指标
	- 例如：水质量评估时的PH值

- 对于落在某个区间内最好的值来说，这样的指标被称为区间型指标
	- 例如：体温、水中植物性营养物量


### 统一指标类型

将所有的指标转化为极大型称为指标正向化

所谓的将原始矩阵正向化，就是要将所有的指标类型统一转化为极大型指标（转化的函数形式可以不唯一）

1. 极小型指标转化为极大型指标的公式：$max - x$

2. 中间型指标转化为极大型指标的公式
	$$
	M = max\{|x_i-x_{best}\}, \bar{x} = 1-{{|x_i-x_{best}|}\over M}
	$$
	其中，${x_i}$是一组中间型指标序列，且最佳的数值为$x_{best}$

3. 区间型转化为极大型指标的公式
	$$
	M = max\{a-min\{x_i\},max\{x_i\}-b\}\\
	\bar{x} =
	\begin{cases}
	1-{{a-x}\over M},&x<a \\
	1,&a\le x\le b \\
	1-{{x-b}\over M}, & x>b
	\end{cases}
	$$
	其中，$\{x_i\}$是一组中间型指标序列，且最佳的区间为$[a,b]$



### 标准化处理

为了消除不同指标量纲的影响，需要对已经正向化的矩阵进行标准化处理。

假设有$n$个要评价的对象，$m$个评价指标构成的正向化矩阵如下：
$$
X=\begin{bmatrix}
x_{11}\ & x_{12} & \cdots & x_{1m} \\
x_{21}\ &x_{22} & \cdots & x_{2m} \\
\vdots \ & \vdots & \ddots & \vdots \\
x_{n1} \ & x_{n2} & \cdots & x_{nm}
\end{bmatrix}
$$
那么对于其标准化的矩阵记为$Z$,$Z$​中的每一个元素：
$$
z_{ij}={x_{ij}\over {\sqrt {\sum_{i=1}^N{x_{ij}^2}}}}
$$

## Topsis如何计算得分

只有一个指标的时候，构造计算评分的公式为${x-min}\over{max-min}$,经过变形后可得${x-min}\over{(max-x)+(x-min)}$

可以看作：${x与最小值的距离}\over{x与最大值的距离+x与最小值的距离}$

类比只有一个指标时候的计算方法：

假设有$n$个要评价的对象,$m$个评价指标的标准化矩阵：
$$
Z=\begin{bmatrix}
z_{11}\ & z_{12} & \cdots & z_{1m} \\
z_{21}\ & z_{22} & \cdots & z_{2m} \\
\vdots \ & \vdots & \ddots & \vdots \\
z_{n1} \ & z_{n2} & \cdots & z_{nm}
\end{bmatrix}
$$
定义最大值
$$
Z^+=(Z_1^+,Z_2^+,\cdots,Z_m^+) \\
  =(max\{z_{11},z_{21}, \cdots,z_{n1}\},
  max\{z_{12},z_{22}, \cdots,z_{n2}\}, \cdots,
  max\{z_{1m},z_{2m}, \cdots,z_{nm}\})
  
$$
定义最小值
$$
Z^-=(Z_1^-,Z_2^-,\cdots,Z_m^-) \\
  =(min\{z_{11},z_{21}, \cdots,z_{n1}\},
  min\{z_{12},z_{22}, \cdots,z_{n2}\}, \cdots,
  min\{z_{1m},z_{2m}, \cdots,z_{nm}\})
$$
定义第$i(i=1,2,\cdots,n)$个评价对象与最大值的距离$D_i^+=\sqrt{\sum_{j=1}^m\omega_j{(Z_j^+-z_{ij})^2}}$

定义第$i(i=1,2,\cdots,n)$个评价对象与最小值的距离$D_i^-=\sqrt{\sum_{j=1}^m\omega_j{(Z_j^--z_{ij})^2}}$

那么，我们可以计算得出第$i(i=1,2,\cdots,n)$个评价对象未归一化的得分：$S_i={{D_i^-}\over{D_i^++D_i^-}}$

很明显$0\le S_i \le 1$,且$S_i$越大$D_i^+$越小，即越接近最大值

其中$\omega_j$为第j个评价指标的权重

可以采用层次分析法来对TOPSIS给评价指标确定权重。

## 基于熵权法对TOPSIS模型的修正

### 层次分析法

基于层次分析法的加权判断矩阵过度依赖于专家，如果专家的判断存在主观性的话，会对结果产生很大的影响

### 熵权法

熵权法是一种客观赋权的方法。

**依据的原理：指标的变异程度（方差）越小，所反映的信息量也越少，其对应的权值也应该越低**

极端的例子：对于所有的样本而言，这个指标都是相同的数值，那么我们可以认为这个指标的权值为0，即这个指标对于我们评价起不到任何的帮助）

#### 如何度量信息量的大小

如果把信息量用字母$I$表示，概率用$p$表示，假设$x$表示事件$X$可能发生的某种情况，$p(x)$表示这种情况发生的概率，我们可以定义：$I(x) = -ln(p(x))$，因为$0\le p(x)\le 1$，所以$I(x)\ge 0$

#### 信息熵

如果事件$X$可能发生的情况分别为：$x_1,x_2,\cdots,x_n$

那么我们可以定义事件$X$的信息熵为：
$$
H(X) = \sum_{i=1}^n[p(x_i)I(x_i)]=-\sum_{i=1}^n[p(x_i)ln(p(x_i))]
$$
从上面的公式可以看出，信息熵的本质就是对信息量的期望值

可以证明的是：

当$p(x_1)=p(x_2)=\cdots=p(x_n)={1\over n}$时，$H(x)$取最大值，此时$H(x) = lnn$

#### 熵权法的计算步骤

1. 判断输入的矩阵中是否存在负数，如果有则要重新标准化到非负区间

	标准化的公式为
	$$
	\bar{z_{ij}}={{x_{ij}-min\{ x_{1j},x_{2j},\cdots,x_{nj} \}}\over{max\{ x_{1j},x_{2j},\cdots,x_{nj} \}-min\{ x_{1j},x_{2j},\cdots,x_{nj} \}}}
	$$

2. 假设有$n$个要评价的对象，$m$个评价指标，且经过了上一步处理得到的非负矩阵为：
	$$
	\bar Z=\begin{bmatrix}
	\bar z_{11}\ &\bar  z_{12} & \cdots & \bar z_{1m} \\
	\bar z_{21}\ & \bar z_{22} & \cdots & \bar z_{2m} \\
	\vdots \ & \vdots & \ddots & \vdots \\
	\bar z_{n1} \ & \bar z_{n2} & \cdots & \bar z_{nm}
	\end{bmatrix}
	$$
	计算概率矩阵$P$，其中每一个元素$p_{ij}$的计算公式为
	$$
	p_{ij}={\bar z_{ij}\over \sum_{i=1}^n \bar z_{ij}}
	$$

3. 计算每个指标的信息熵，并计算信息效用值，并归一化得到每个指标的熵权

	对于第$j$个指标而言，其信息熵的计算公式为：
	$$
	e_j = -{1\over lnn}\sum_{i=1}^nln(p_{ij})(j=1,2,\cdots,m)
	$$

	- 这里为什么要除以lnn这个常数？

		能够使得信息熵的区间始终位于$[0,1]$区间上面

	- $e_j$越大，即第$j$个指标的信息熵越大，表明第$j$个指标的信息越多还是越少？

		越少，当$p_{1j}=p_{2j}=\cdots=p_{nj}$时，$e_j=1$，此时上面定义的信息熵达到最大，由于$p_{ij}={\bar z_{ij}\over \sum_{i=1}^n \bar z_{ij}}$，所以所有指标都相同

	**信息效用值**：$d_j=1-e_j$，信息熵越大，信息效用值越小，即信息效用值越大时，其所对应的信息就越多。将信息效用值进行归一化，我们就可以得到每个指标的熵权：
	$$
	W_j = {d_j \over {\sum_{j=1}^m}d_j}(j=1,2,\cdots,m)
	$$

### 熵权法背后的原理

可以用指标的标准差来衡量样本的变异程度，指标的标准差越大，意味着包含的信息越多，信息熵越小，信息效用值越大。

